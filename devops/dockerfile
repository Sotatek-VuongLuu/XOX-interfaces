FROM us-west2-docker.pkg.dev/practical-yew-383010/staging-xox-base/node-16:latest as builder
RUN mkdir -p /home/node/app
WORKDIR /home/node/app

COPY . .
COPY .env /home/node/app/apps/web/.env.production
RUN yarn install && yarn build

FROM us-west2-docker.pkg.dev/practical-yew-383010/staging-xox-base/node-16-slim
RUN mkdir -p /home/node/app
WORKDIR /home/node/app
COPY --from=builder /home/node/app /home/node/app 
EXPOSE 3001

CMD ["yarn", "run" , "start"]
